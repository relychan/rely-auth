{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://github.com/relychan/rely-auth/auth/rely-auth-config",
  "$ref": "#/$defs/RelyAuthConfig",
  "$defs": {
    "AllOrListString": {
      "oneOf": [
        {
          "type": "string",
          "enum": [
            "*"
          ]
        },
        {
          "items": {
            "type": "string"
          },
          "type": "array"
        }
      ]
    },
    "AuthMode": {
      "type": "string",
      "enum": [
        "apiKey",
        "jwt",
        "webhook",
        "noAuth"
      ],
      "description": "Authentication mode enum"
    },
    "EnvAny": {
      "anyOf": [
        {
          "required": [
            "value"
          ],
          "title": "value"
        },
        {
          "required": [
            "env"
          ],
          "title": "env"
        }
      ],
      "properties": {
        "value": true,
        "env": {
          "type": "string"
        }
      },
      "additionalProperties": false,
      "type": "object"
    },
    "EnvString": {
      "anyOf": [
        {
          "required": [
            "value"
          ],
          "title": "value"
        },
        {
          "required": [
            "env"
          ],
          "title": "env"
        }
      ],
      "properties": {
        "value": {
          "type": "string"
        },
        "env": {
          "type": "string"
        }
      },
      "additionalProperties": false,
      "type": "object"
    },
    "EnvStringSlice": {
      "anyOf": [
        {
          "required": [
            "value"
          ],
          "title": "value"
        },
        {
          "required": [
            "env"
          ],
          "title": "env"
        }
      ],
      "properties": {
        "value": {
          "items": {
            "type": "string"
          },
          "type": "array"
        },
        "env": {
          "type": "string"
        }
      },
      "additionalProperties": false,
      "type": "object"
    },
    "FieldMappingEntryConfig": {
      "properties": {
        "path": {
          "type": "string"
        },
        "default": {
          "$ref": "#/$defs/EnvAny"
        }
      },
      "additionalProperties": false,
      "type": "object"
    },
    "FieldMappingEntryStringConfig": {
      "properties": {
        "path": {
          "type": "string"
        },
        "default": {
          "$ref": "#/$defs/EnvString"
        }
      },
      "additionalProperties": false,
      "type": "object"
    },
    "JWTClaimsConfig": {
      "properties": {
        "namespace": {
          "$ref": "#/$defs/JWTClaimsNamespace",
          "description": "Used when all of JWT claims are present in a single object within the decoded JWT."
        },
        "locations": {
          "additionalProperties": {
            "$ref": "#/$defs/FieldMappingEntryConfig"
          },
          "type": "object",
          "description": "Can be used when JWT claims are not all present in the single object,\nbut individual claims are provided a JSON pointer within the decoded JWT and optionally a default value."
        }
      },
      "additionalProperties": false,
      "type": "object",
      "description": "JWTClaimsConfig represents the claims config. Either specified via claims mappings or namespace."
    },
    "JWTClaimsFormat": {
      "type": "string",
      "enum": [
        "Json",
        "StringifiedJson"
      ],
      "description": "The format in which JWT claims will be present"
    },
    "JWTClaimsNamespace": {
      "properties": {
        "location": {
          "type": "string",
          "description": "Path to lookup the Hasura claims within the decoded claims."
        },
        "claimsFormat": {
          "$ref": "#/$defs/JWTClaimsFormat",
          "description": "Format in which the Hasura claims will be present."
        }
      },
      "additionalProperties": false,
      "type": "object",
      "required": [
        "location",
        "claimsFormat"
      ],
      "description": "JWTClaimsNamespace is used when all of JWT claims are present in a single object within the decoded JWT."
    },
    "JWTKey": {
      "oneOf": [
        {
          "properties": {
            "algorithm": {
              "$ref": "#/$defs/JWTSignatureAlgorithm"
            },
            "key": {
              "$ref": "#/$defs/EnvString",
              "description": "Inline value of the key to use for decoding the JWT"
            }
          },
          "type": "object",
          "required": [
            "algorithm",
            "key"
          ]
        },
        {
          "properties": {
            "algorithm": {
              "$ref": "#/$defs/JWTSignatureAlgorithm"
            },
            "jwkFromUrl": {
              "$ref": "#/$defs/EnvString",
              "description": "A URL where a provider publishes their JWKs (JSON Web Keys - which are used for signing the JWTs). The URL must publish the JWKs in the standard format as described in the RFC 7517 specification."
            }
          },
          "type": "object",
          "required": [
            "jwkFromUrl"
          ]
        }
      ]
    },
    "JWTSignatureAlgorithm": {
      "type": "string",
      "enum": [
        "ES256",
        "ES384",
        "ES512",
        "EdDSA",
        "HS256",
        "HS384",
        "HS512",
        "PS256",
        "PS384",
        "PS512",
        "RS256",
        "RS384",
        "RS512"
      ],
      "description": "Specifies the cryptographic signing algorithm which is used to sign the JWTs. This is required only if you are using the key property in the config."
    },
    "RelyAuthAPIKeyConfig": {
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identity of the auth config.\nIf not set, ID will be the index of the array."
        },
        "mode": {
          "$ref": "#/$defs/AuthMode",
          "description": "Authentication mode which is always apiKey."
        },
        "description": {
          "type": "string",
          "description": "Brief description of the auth config."
        },
        "tokenLocation": {
          "$ref": "#/$defs/TokenLocation",
          "description": "Source of the authentication token."
        },
        "sessionVariables": {
          "additionalProperties": {
            "$ref": "#/$defs/EnvAny"
          },
          "type": "object",
          "description": "Custom session variables for this auth mode."
        },
        "value": {
          "$ref": "#/$defs/EnvString",
          "description": "Value of the static API key to be compared."
        },
        "securityRules": {
          "$ref": "#/$defs/RelyAuthSecurityRulesConfig"
        }
      },
      "additionalProperties": false,
      "type": "object",
      "required": [
        "mode",
        "tokenLocation",
        "sessionVariables",
        "value"
      ],
      "description": "RelyAuthAPIKeyConfig contains configurations for HTTP authentication with static secrets."
    },
    "RelyAuthConfig": {
      "properties": {
        "settings": {
          "$ref": "#/$defs/RelyAuthSettings",
          "description": "Global settings of the auth config."
        },
        "definitions": {
          "items": {
            "$ref": "#/$defs/RelyAuthDefinition"
          },
          "type": "array",
          "description": "List of authenticator configurations."
        }
      },
      "additionalProperties": false,
      "type": "object",
      "required": [
        "definitions"
      ],
      "description": "RelyAuthConfig is the data structure for authentication configurations."
    },
    "RelyAuthDefinition": {
      "oneOf": [
        {
          "$ref": "#/$defs/RelyAuthAPIKeyConfig"
        },
        {
          "$ref": "#/$defs/RelyAuthJWTConfig"
        },
        {
          "$ref": "#/$defs/RelyAuthNoAuthConfig"
        },
        {
          "$ref": "#/$defs/RelyAuthWebhookConfig"
        }
      ]
    },
    "RelyAuthHeaderAllowListSetting": {
      "properties": {
        "headers": {
          "items": {
            "type": "string"
          },
          "type": "array"
        },
        "patterns": {
          "$ref": "#/$defs/EnvStringSlice"
        }
      },
      "additionalProperties": false,
      "type": "object",
      "required": [
        "patterns"
      ],
      "description": "RelyAuthHeaderAllowListSetting represents a setting for header allow list."
    },
    "RelyAuthJWTConfig": {
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identity of the auth config.\nIf not set, ID will be the index of the array."
        },
        "mode": {
          "$ref": "#/$defs/AuthMode",
          "description": "Authentication mode which is always jwt."
        },
        "description": {
          "type": "string",
          "description": "Brief description of the auth config."
        },
        "audience": {
          "items": {
            "type": "string"
          },
          "type": "array",
          "description": "Validation to check that the aud field is a member of the audience received, otherwise will throw error.\nRequired if there are many JWT auth configurations."
        },
        "issuer": {
          "type": "string",
          "description": "Validation to check that the iss field is a member of the iss received, otherwise will throw error.\nRequired if there are many JWT auth configurations."
        },
        "allowedSkew": {
          "type": "integer",
          "description": "The allowed leeway (in seconds) to the exp validation to account for clock skew."
        },
        "tokenLocation": {
          "$ref": "#/$defs/TokenLocation",
          "description": "Source of the JWT authentication token."
        },
        "key": {
          "$ref": "#/$defs/JWTKey",
          "description": "Information of the JWT key to verify the token."
        },
        "claimsConfig": {
          "$ref": "#/$defs/JWTClaimsConfig",
          "description": "Configuration to describe how and where the engine should look for the claims within the decoded token.\nYou can vary the format and location of the claims."
        },
        "securityRules": {
          "$ref": "#/$defs/RelyAuthSecurityRulesConfig"
        }
      },
      "additionalProperties": false,
      "type": "object",
      "required": [
        "mode",
        "tokenLocation",
        "key",
        "claimsConfig"
      ],
      "description": "RelyAuthJWTConfig according to which the incoming JWT will be verified and decoded to extract the session variable claims."
    },
    "RelyAuthNoAuthConfig": {
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identity of the auth config.\nIf not set, ID will be the index of the array."
        },
        "mode": {
          "$ref": "#/$defs/AuthMode",
          "description": "Authentication mode which is always noAuth."
        },
        "sessionVariables": {
          "additionalProperties": {
            "$ref": "#/$defs/EnvAny"
          },
          "type": "object",
          "description": "Custom session variables for this auth mode."
        },
        "securityRules": {
          "$ref": "#/$defs/RelyAuthSecurityRulesConfig"
        }
      },
      "additionalProperties": false,
      "type": "object",
      "required": [
        "mode",
        "sessionVariables"
      ],
      "description": "RelyAuthNoAuthConfig contains the definition config for unauthenticated users."
    },
    "RelyAuthSecurityRulesConfig": {
      "properties": {
        "allowedIPs": {
          "$ref": "#/$defs/RelyAuthHeaderAllowListSetting",
          "description": "Configure the list of allowed IPs."
        },
        "allowedHosts": {
          "$ref": "#/$defs/RelyAuthHeaderAllowListSetting",
          "description": "Configure the list of allowed hosts."
        }
      },
      "additionalProperties": false,
      "type": "object",
      "description": "RelyAuthSecurityRulesConfig defines configurations of security rules."
    },
    "RelyAuthSettings": {
      "properties": {
        "strict": {
          "type": "boolean",
          "description": "Strict mode, when enabled will return HTTP 401 if the token is found but unauthorized.\nIt won't fallback to the noAuth mode."
        },
        "reloadInterval": {
          "type": "integer",
          "minimum": 0,
          "description": "The interval in seconds to reload JSON web keys from the remote URL.\nIf the value is zero or negative, disables the process.",
          "default": 0
        }
      },
      "additionalProperties": false,
      "type": "object",
      "description": "RelyAuthSettings holds global settings for the authenticators."
    },
    "RelyAuthWebhookConfig": {
      "oneOf": [
        {
          "properties": {
            "method": {
              "type": "string",
              "enum": [
                "GET"
              ],
              "description": "GET webhook method"
            },
            "customRequest": {
              "properties": {
                "headers": {
                  "$ref": "#/$defs/WebhookAuthHeadersConfig"
                }
              },
              "type": "object",
              "description": "Configurations for request headers and transformed request body to be sent to the auth hook"
            }
          },
          "type": "object"
        },
        {
          "properties": {
            "method": {
              "type": "string",
              "enum": [
                "POST"
              ],
              "description": "POST webhook method"
            },
            "customRequest": {
              "properties": {
                "headers": {
                  "$ref": "#/$defs/WebhookAuthHeadersConfig"
                },
                "body": {
                  "$ref": "https://raw.githubusercontent.com/relychan/gotransform/refs/heads/main/jsonschema/gotransform.schema.json"
                }
              },
              "type": "object",
              "description": "Configurations for request headers and transformed request body to be sent to the auth hook"
            }
          },
          "type": "object"
        }
      ],
      "properties": {
        "mode": {
          "type": "string",
          "enum": [
            "webhook"
          ],
          "description": "Authentication mode which is always webhook"
        },
        "description": {
          "type": "string",
          "description": "Brief description of the auth config"
        },
        "url": {
          "$ref": "#/$defs/EnvString",
          "description": "The URL of the authentication webhook"
        },
        "httpClient": {
          "$ref": "https://raw.githubusercontent.com/relychan/gorestly/refs/heads/main/jsonschema/gorestly.schema.json",
          "description": "Configurations for the HTTP client"
        },
        "customResponse": {
          "$ref": "#/$defs/WebhookAuthCustomResponseConfig",
          "description": "The configuration for transforming response bodies"
        },
        "securityRules": {
          "$ref": "#/$defs/RelyAuthSecurityRulesConfig"
        }
      },
      "type": "object",
      "required": [
        "mode",
        "url",
        "method"
      ]
    },
    "TemplateTransformerConfig": {
      "properties": {
        "TemplateTransformerConfig": {
          "$ref": "#/$defs/TemplateTransformerConfig"
        }
      },
      "additionalProperties": false,
      "type": "object",
      "required": [
        "TemplateTransformerConfig"
      ]
    },
    "TokenLocation": {
      "properties": {
        "in": {
          "type": "string",
          "enum": [
            "header",
            "query",
            "cookie"
          ],
          "default": "header"
        },
        "name": {
          "type": "string",
          "default": "Authorization"
        },
        "scheme": {
          "type": "string"
        }
      },
      "additionalProperties": false,
      "type": "object",
      "required": [
        "in",
        "name"
      ]
    },
    "WebhookAuthCustomResponseConfig": {
      "properties": {
        "response": {
          "$ref": "#/$defs/TemplateTransformerConfig",
          "description": "The template to transform the response body."
        }
      },
      "additionalProperties": false,
      "type": "object",
      "description": "WebhookAuthCustomResponseConfig is the configuration for transforming response bodies."
    },
    "WebhookAuthHeadersConfig": {
      "properties": {
        "forward": {
          "$ref": "#/$defs/AllOrListString",
          "description": "The headers to be forwarded from the client request."
        },
        "additional": {
          "additionalProperties": {
            "$ref": "#/$defs/FieldMappingEntryStringConfig"
          },
          "type": "object",
          "description": "The additional headers to be sent to the auth hook."
        }
      },
      "additionalProperties": false,
      "type": "object",
      "description": "WebhookAuthHeadersConfig is the configuration for the headers to be sent to the auth hook."
    }
  }
}